<li class="dropdown" id="login_button_li">
	<% if (!user.identity) { %>
		<button class="btn btn-warning navbar-btn dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" id="login_dropdown" style="font-weight: 700;">
			<span id="sign_in_text"><%=l('Sign in')%></span> <span class="caret"></span>
		</button>
	<% } else { %>
		<button class="btn btn-success navbar-btn dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" id="login_dropdown" style="font-weight: 700;">
			<span id="sign_in_text"><%=user.name.substring(0,8)%></span> <span class="caret"></span>
		</button>
	<% }%>
	
	<ul class="dropdown-menu" id="login_dropdown_select" aria-labelledby="login_dropdown">
		<li><a data-action='/auth/steam' href="javascript:void(0)"><div class="inline icon icon-steam"></div>&nbsp; Steam</a></li>
		<li><a href="https://<%=url.split('/')[0]%>/logout"><div class="inline icon icon-logout"></div>&nbsp; <%=l('Log out')%></a></li>
	</ul>
</li>

<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) { 
	var login_options = document.getElementById("login_dropdown_select").children;
	for (var i in login_options) {
		if (login_options.hasOwnProperty(i)) {
			login_options[i].children[0].onclick = function() {
				if (this.hasAttribute('data-action')) {
					var f = document.createElement("form");
					f.setAttribute('method', "POST");
					f.setAttribute('action', this.getAttribute('data-action'));	
					if (this.hasAttribute('id')) {
						var i = document.createElement("input");
						i.setAttribute('type', "hidden");
						i.setAttribute('name', "openid_identifier");
						i.setAttribute('value', this.getAttribute('id'));
						f.appendChild(i);
					}
					document.getElementsByTagName('body')[0].appendChild(f);
					f.submit();
				}
			}
		}
	}
});
</script>
